--------------------------------------------
StaticFileMaker - readme.txt
--------------------------------------------

[0.目次]
  1.概要
  2.動作確認環境
  3.インストール
  4.アンインストール
  5.使い方
  6.注意事項


[1.概要]
MODXのリソースを静的ファイルにして運用する事ができます。
(MovableTypeのような運用が可能です)
リソースを静的ファイル化することで次のメリットが発生します。

・MODXを介さなくなるため、レスポンスの向上
・リソース編集後にファイル生成するまで公開されないため、プレビューで公開前に
  表示状態を確認できる

デメリットは次の通りです。

・MODXを介さないため、MODXアクセス制限等が機能しなくなる
・MTのようなアーカイブページは出力しないため、実はイマイチかもしれない…


[2.動作確認環境]
・MODX 1.0.6J
・PHP5.3.10
・MySQL 5.5.18
・文字コード UTF-8

また次の制約があります。

・フレンドリーの設定がURL必須です
・リソースの公開開始日時/公開終了日時が機能しなくなります
  正確には機能しますが、静的ファイルに対しては効果がありません
・MODXをドメイントップにインストールしないと動きません
  http://example.jp/modx/ のようにサブディレクトリにMODXを入れると動作しません


[3.インストール]
1)アーカイブファイルを解凍する

2)管理画面でプラグインを新規作成します。
  「エレメント」→「エレメント管理」→「プラグイン」→「プラグインを作成」

  [メイン]
    プラグインコード: StaticFileMaker.txtファイルの中身をそのまま張りつける

  [設定]
    プラグインコードを貼り付けると「静的ファイル生成用パスワード」という設定
    ができているので、適当にパスワードを設定する

      ※静的ファイル生成用にMODX内部で使うパスワードです
      ※10文字以上の英数字にしておけばいいと思います

3)管理画面でテンプレート変数を作成する
  「エレメント」→「エレメント管理」→「テンプレート変数」
                                         →「テンプレート変数を作成」

  [メイン]
    変数名               : RebuildExcept
    見出し               : 静的ファイル生成
    入力タイプ           : Check Box
    入力時のオプション値 : 対象外にする
    規定値               : (空白のまま)
    ウィジェット         : (選択無)

  [テンプレートとの関連付け]
    静的ファイルを生成したくないリソースがあるテンプレート
    (よくわかれなければ全てにチェックでもOKです)

  [プロパティ]
    既存のカテゴリー     : StaticFileMaker

4).htaccessファイルを修正する
バージョンによって微妙に表記が違う事があるので適宜合わせてください。
以下はMODX 1.0.6Jの場合です。

-----------------------変更前(ここから)
# For Friendly URLs
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . index.php [L]
-----------------------変更前(ここまで)

-----------------------変更後(ここから)
# For Friendly URLs
RewriteRule ^index\.php$ - [L]
#↓追加
RewriteRule ^(manager|assets)/.*$ - [L]
RewriteCond %{QUERY_STRING} __rebuild=.+ [OR]
RewriteCond %{HTTP_COOKIE} __rebuild=.+
RewriteCond %{QUERY_STRING} !__rebuild_pfile=1
RewriteRule . index.php [L]
#↑追加
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . index.php [L]
-----------------------変更後(ここまで)

余談ですが、追加の1行目はMODX 1.0.6J-r1以降では不要になります。
(1.0.6Jでは本体のバグのため必要)


[4.アンインストール]
作成したプラグインとテンプレート変数を削除します。
.htaccessファイルを元に戻します。


[5.使い方]
リソースの編集画面を開くと右上に次のメニューが増えています。

・保存+ファイル生成/削除
  リソースを保存しつつ、静的ファイルを生成します。
  「公開ステータス」を非公開にするとファイルが削除されます。

・ファイルプレビュー
  静的ファイルのプレビューを行います。

・全ファイル生成
  全ファイルを生成するウィンドウを開きます。
  (MTの再構築画面のようなもの)
  「全ファイル生成」で生成を開始します。
  「ウィンドウを閉じる」でウィンドウを閉じます。

なお、静的ファイルをつくる条件は次の通りです。

・公開されている
・削除されていない
・メンバー限定の設定が行われていない

問い合わせフォームなど、動的に動くサイトで静的ファイルを生成したくない場合は
リソース編集画面にて「静的ファイル生成」の「対象外にする」にチェックを入れて
ください。
ここにチェックの入っているリソースも静的ファイルを作りません。


[6.注意事項]
思いつき＆勢いで作りました。
要望があれば拡張していくかもしれません。
